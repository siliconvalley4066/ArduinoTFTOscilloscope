2022/03/29 TFT_Oscillo_mod

■Known Bugs

波形表示が所々途切れることがある。

起動時等に電圧表示がボタン領域まではみ出ることがある。

97us/divレンジでトリガーチャンネルをTG2にすると、CH2の波形が観測できる。これはこれで使えそうなバグなので残しておく。

100ms/divレンジ以上でFFT表示にならない。そもそもそのようにコーディングしていないし直す気は無い。

原理的に周波数測定には画面上で2周期以上が必要。

周波数測定と電圧測定はCH1のみ。CH2のみ表示でもCH1の測定値が出る。

トリガが掛からない状態でトリガモードをNormかOneにすると、トリガ検出から抜け出せなくなり操作不能になる。トリガが掛かる入力を入れれば復帰する。リセットしてもEEPROMにNormかOneのモードででセーブされているとトリガが掛からないと復帰できない。EEPROMの先頭アドレスをずらしてスケッチを書き込み直せばデフォールトの設定に戻る。

2ch表示で信号源インピーダンスが大きい場合は(目安として100kohm以上で入力無接続や10:1プローブ接続を含む)相互に観測波形に影響が出る。どちらか一方のチャンネルをOFFにすれば回避できるようにした。入力にOPアンプのボルテージフォロワを入れれば良さそうだが手軽に作れることから外れるので諦めた。入力インピーダンスが下がるのを許容して入力回路の抵抗値2Mohmを100kohm以下に下げれば軽減できると思う。

1ch表示でも信号源インピーダンスが大きい場合はトリガーソースを他チャンネルにすると波形の最初500us程度が乱れる。

2ch間でレベル差が大きい部分には相互干渉が発生することがある。

等価時間サンプリングではトリガレベルは内部基準電圧の約1.1V固定で変更できない。D6ピンがLCDシールドで使われているためどうしようもない。また、50usecのディレイトリガ固定にしている。

等価時間サンプリングでは基本的にCH1のみの計測だが、CH2をOnにするとCH2の波形をCH1の色で表示する。極性の反転はCH1側の設定に従う。実際の波形の取り込みはどちらか一方しかしない。

ATMEGA328の性能限界のため、実時間サンプリングの200us/divレンジ以下では実効分解能が6bit以下になる。500us/divレンジでも8bit未満になる。そのために波形がつぶれて見える。

等価時間サンプリングではTimer1を使うので、Timer1を使うキャリブレーションパルスは使えない。

等価時間サンプリングの特定の周波数でトリガが不安定になる(例えば94usレンジで入力2kHz)。

■改良可能性

CH1/CH2のモード選択をポップアップメニュー風にした方が便利かもしれない。

電圧レンジの選択も一方向順次切り替えよりもup/downにするか、ポップアップメニュー風にした方が便利かもしれない。

トリガレベルの変更をドラッグ風にしたい。画面タッチでも変えられるようにしてみた。

垂直位置の変更をドラッグ風にしたい。

時間軸拡大を追加したい。部分的に盛り込み済みだが未使用。スケッチ中のClearAndDrawGraphMag(1)の"1"を2から10程度に変えれば1ms以下のレンジで拡大できる。ただしグリッドの線の再描画まで対応できていない。

電源電圧を測定して電圧を表示・補正。

内部基準電圧1.1Vを使って電圧感度アップ。タッチスクリーンが5V基準なので面倒くさい。

Hold Off調整機能を入れた方が便利かもしれない。

等価時間サンプリングでのディレイトリガのディレイ量を変更できるようにGUIを追加したい。

特に等価時間サンプリングの時間軸が中途半端な値になっているので、スケーリングしてきりの良い値にしたい。


とは言え、スケッチが27456バイト、UNOで85%、Nanoで90%なので何かを加えると何かを削る必要がある。
